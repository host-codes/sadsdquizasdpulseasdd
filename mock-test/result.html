<!DOCTYPE html>
<html lang="en">
<head>
  <title>Test Results</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cabin+Sketch&display=swap" rel="stylesheet">
 <!-- Firebase and Bootstrap JS -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
 

<style>
body{

    background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQ4MCIgaGVpZ2h0PSI2NTAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ICAgIDxwYXRoIGQ9Ik03MzEuMjA3IDY0OS44MDJDOTM1LjQ4NCA2NDIuMTQgMTQ4MCAzMzcuMzI1IDE0ODAgMTgwLjg4OGMwLTE1Ni40MzgtMzA5Ljc0NC0zNi4wNTUtNzIwLTM2LjA1NVMwLTE3NC40ODMgMCAxMzUuMTQ0YzAgMzA5LjYyNyA1MjYuOTMgNTIyLjMyIDczMS4yMDcgNTE0LjY1OHoiIGZpbGw9IiNGNkY4RkEiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg==);
    /*background-size: 1140px 500px; */
	    background-size: 2257px 743px;
    background-repeat: no-repeat;
}



::-webkit-scrollbar {
    width: 9px;
}

 
::-webkit-scrollbar-track {
  -webkit-box-shadow: inset 0 0 6px rgb(0 0 0 / 30%);
    border-radius: 10px;
}
 
::-webkit-scrollbar-thumb {
       border-radius: 10px;
    -webkit-box-shadow: inset 0 0 6px #000000;
}


/* Handle on hover */
::-webkit-scrollbar-thumb:hover {
    -webkit-box-shadow: inset 0 0 6px #241fcd;;
}



.btnmainresults,
	.btnreattemptlist,
	.btnreattempttest {
    padding: 5px 0px;
    color: var(--white);
    border: none;
    border-radius: 50px;
    font-size: 16px;
    cursor: pointer;
    text-decoration: none;
    text-align: center;
    transition: var(--transition);
    width: 16%;
    background: linear-gradient(90deg,rgb(155 89 182) 0%, rgb(190 143 219) 50%, rgb(159 93 191) 100%);
    color: #ffffff;
	box-shadow: 0 4px 12px 0px rgb(95 93 96 / 69%);
}

.btnmainresults:hover, .btnreattemptlist:hover, .btnreattempttest:hover {
    background: linear-gradient(90deg,rgb(189 140 218) 0%, rgb(161 97 193) 50%, rgb(188 140 217) 100%);
}
	
span#user-name {
    font-weight: 640;
    color: #65518b;
	    text-shadow: -1px 2px 20px #040404;
}	
</style>
<style>
  
h1.text-centerp {
    font-size: 19px;
   color: #848485;
   margin-top: 36px;
}
p#test-title {
    font-size: 21px;
    color: #776d9b;
    font-weight: 500;
}
 

  .score-card {
   background: linear-gradient(136deg, #a488d7, #f6f8fa,#f6f8fa);
    color: #5c5c5c;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    /* box-shadow: 0 4px 20px rgb(0 0 0 / 10%); */
    /* background: linear-gradient(to right, rgba(0, 0, 0, 0.05), transparent); */
    /* border-left: 1px solid #999; */
}
 .metric-card {
    background: #f5f1eb;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgb(0 0 0 / 5%);
    /* border: 2px solid #dddbdb; */
}
    .question-analysis {
      max-height: 500px;
      overflow-y: auto;
    }
   /* .correct-answer {
      background-color: #d4edda;
    }
    .wrong-answer {
      background-color: #f8d7da;
    }
    .skipped-answer {
      background-color: #e2e3e5;
    } */
    .time-spent {
      font-size: 0.9rem;
      color: #6c757d;
    }
	
	h1#score-display {
    font-size: 28px;
}

h4#percentage,#accuracy,#rank{
    font-size: 19px;}
img.score-icon {
    height: 31px;
    width: 31px;}

a.link {
    text-decoration: none;
    color: #8d70e3;}
  </style>

<style>
.answer-circle {
  display: inline-block;
  width: 26px;
  height: 26px;
  border-radius: 50%;
  text-align: center;
  line-height: 26px;
  color: white;
  font-weight: bold;
}
.correct-circle {
  background-color: #28a745; /* Green */
}
.incorrect-circle {
  background-color: #dc3545; /* Red */ 
}
.skipped-circle {
  background-color: #6c757d; /* Gray */
}
.answered-circle {
  background-color: #007bff; /* Blue */
}
</style>



<style>
.col-sm-2 {
    /* background: #fff; */
    /* box-shadow: 0 0 6px rgb(0 0 0 / 10%); */
    border-radius: 6px;
    display: inline-block;
    padding: 1px 6px;
    margin: 0 -10px;
        width: 185px;
    height: 69px;
}


		table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
     th, td {
    border: 3px solid whitesmoke;
    padding: 4px;
    text-align: center;
}


tr:nth-child(even) {
/*background-color: #D6EEEE;*/
    background: linear-gradient(79deg, #c3c3c3, #f5f1eb,#f5f1eb);
}

        tr:hover {
            background-color: hsl(360deg * Math.random(), 70%, 80%);
        }
		
		
		tr:hover {background-color: #D6EEEE;}
		
		 table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

      

        th {
            background-color: #8d8a8a;
            color: white;
        }

        .correct {
            background-color: rgb(212, 237, 218);
            color: #0c0c0c;
        }

        .incorrect {
            background-color: rgb(248, 215, 218);
            color: #0c0c0c;
        }
		
</style>

  <style>
  
  .col-lg-2 {
    flex: 0 0 auto;
    width: 13.666667%;
}
  .score-box {
    background: #fff;
    border-radius: 6px;
    /* box-shadow: 0 2px 8px rgb(0 0 0 / 10%); */
    padding: 10px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-width: 120px;
    height: 74px;
    transition: 0.3s;
     width: 146px;
    box-shadow: inset 0 0 20px 1px rgb(0 0 0 / 16%);
}

    .score-box:hover {
      transform: translateY(-4px);
    }

    .score-icon {
      height: 40px;
      width: 40px;
      object-fit: contain;
      margin-right: 10px;
    }

    .score-text {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .score-title {
      font-size: 14px;
      color: #666;
      margin: 0;
    }

    .score-value {
      font-size: 18px;
      font-weight: bold;
      color: #000;
      margin: 0;
    }
	
	div.example {
  background-color: yellow;
  padding: 20px;
}

.bubble-3 {
    /* margin-right: 13em; */
    margin-left: -8em;
}
.bubble3 {
    margin-left: 64em;
}
	
@media screen and (max-width: 600px) {
	  .col-sm-2 {
    padding: 0px 6px;
    margin: 9px 12px;}
	
	}
	

  </style>
  
  
  
    
   <style>
 
    nav {
    width: 100%;
    /* background-color: #ffffff; */
    color: #040404;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 20px;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1000;
    height: 52px;
    /* background: linear-gradient(34deg, #f6f8fa, #ffffff,#ffffff); */
	background: linear-gradient(17deg, #ffffff,#f6f8fa, #ffffff, #ffffff, #ffffff, #ffffff,#ffffff);
    }

    .logo {
	  font-weight: 300;
    font-family: 'Cabin Sketch', sans-serif;
    font-size: 29px;
    color: #8d70e3;
    text-shadow: -1px 2px 5px #3f3c3c;
    }

   

    /* Hide the checkbox */
    #check {
      display: none;
    }

    .checkbtn {
      display: none;
      cursor: pointer;
    }

    /* SVG Icon Styling */
    .checkbtn svg {
      width: 24px;
      height: 24px;
      fill: white;
	  margin-left: 24em;
    }


ul.dropdown-menu.dropdown-menu-end.show {
    background-color: #e5e5e5;
}


    /* Responsive menu */
   /* Responsive */
    @media (max-width: 768px) {
      .checkbtn {
        display: block;
      }

#user-avatar {
    width: 30px;
    height: 30px;
    object-fit: cover;
    margin-right: 29px;
   /* margin-left: -226px;*/
}
      
      #check:checked ~ ul {
        left: 0;
      }
    }
  </style>
  
      <style>
        img {
    max-width: 100%;
    height: auto;
}
        section {
            padding: 60px 0;
           /* min-height: 100vh;*/
        }
 ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }
.contact-area {
        border-bottom: 1px solid #cdcdcd;
}

.contact-content p {
    font-size: 15px;
    margin: 30px 0 60px;
    position: relative;
}

.contact-content p::after {
    background: #bababb;
    bottom: -30px;
    content: "";
    height: 1px;
    left: 50%;
    position: absolute;
    transform: translate(-50%);
    width: 80%;
}

.contact-content h6 {
    color: #8b8b8b;
    font-size: 15px;
    font-weight: 400;
    margin-bottom: 10px;
}

.contact-content span {
    color: #353c47;
    margin: 0 10px;
}

.contact-social {
    margin-top: 30px;
}

.contact-social > ul {
    display: inline-flex;
}

.contact-social ul li a {
    border: 1px solid #8b9199;
    color: #8b9199;
    display: inline-block;
    height: 40px;
    margin: 0 10px;
    padding-top: 7px;
    transition: all 0.4s ease 0s;
    width: 40px;
	border-radius: 50px;
}

.contact-social ul li a:hover {
    border: 1px solid #FAB702;
    color: #FAB702;
}

.contact-content img {
    max-width: 210px;
}

section{
   /* background: #f0eef7; */
    color: #8b8b8b;
	/* background: linear-gradient(179deg, #d5d5d5,#e3e3e3, #ebebeb, #e9e9e9, #e9e9e9, #ffffff,#ffffff);*/
	
   	    background: linear-gradient(179deg, #ebebeb ,#ffffff,#e9e9e9,#e9e9e9,#ebebeb,#e3e3e3,#d5d5d5);
}
section{ border-top: 2px solid #ffffff;}

h5.footerp {
    padding: 19px 0;
    text-align: center;
    background-color: gainsboro;
    margin-bottom: 0px;
    font-size: 15px;
    color: #878787;
    font-weight: 420;
}
footer img {
    width: 44px;
}
  
  
 
    ul li a {
          text-decoration: none;
    color: #8d8d8d;
    font-size: 16px;
    transition: 0.3s;
    }

    ul li a:hover {
      color: #bb94cf;
    }
	
	.text-center {
    text-align: center!important;
}
  </style>
  
  
  <style>
/* Fixed header styling */
.header {
  position: relative;
padding: 10px 20px;
display: flex;
   color: var(--text-color, #000);
}

.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 60px;
  background-color: #fff;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  z-index: 1000;
  transition: background-color 0.3s ease;
}

/* Logo style */
.header .logo {
  font-size: 20px;
  font-weight: bold;
  color: #333;
}

/* Right section (toggle + profile) */
.header-right {
  display: flex;
  align-items: center;
  gap: 20px;
}

/* Dark mode toggle switch */
.toggle-container {
  position: relative;
  width: 50px;
  height: 25px;
}

.toggle-switch {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-label {
  position: absolute;
  cursor: pointer;
  background-color: #ccc;
  border-radius: 25px;
  width: 100%;
  height: 100%;
  transition: background-color 0.3s ease;
}

.toggle-label .toggle-ball {
  position: absolute;
  top: 2px;
  left: 3px;
  width: 20px;
  height: 20px;
  background-color: #fff;
  border-radius: 50%;
  transition: transform 0.3s ease;
}

.toggle-switch:checked + .toggle-label {
  background-color: #4CAF50;
}

.toggle-switch:checked + .toggle-label .toggle-ball {
  transform: translateX(24px);
}

/* Profile Image */
.profile-pic {
  width: 35px;
  height: 35px;
  border-radius: 50%;
  cursor: pointer;
  object-fit: cover;
}
h5.mb-0 {
    font-size: 17px;
    font-weight: 600;
    color: #757578;
}

/* Dropdown Menu */
.dropdown {
  position: relative;
}

.dropdown-menu {
  position: absolute;
  top: 20px;
  right: 0;
  background-color: #f3f3f3;
  box-shadow: 0 4px 8px rgb(0 0 0 / 10%);
  border-radius: 8px;
  display: none;
  flex-direction: column;
  min-width: 150px;
  padding: 10px 0;
   z-index: 1001;
    list-style: none;
}




.dropdown-menu.show {
  display: flex;
}


.dropdown-menu li:hover {
  background-color: #f5f5f5;
}



.dropdown {
  position: relative;
}




.dropdown-menu li {
    padding: 5px 18px;

    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 1px solid #d5d5d5;
	
	list-style: none;

  cursor: pointer;
  transition: background-color 0.2s ease;
	}

.modal-headerp {
    background: #ff9292;
    padding: 1rem;
    border-radius: 7px;
    box-shadow: inset 0 2px 20px 19px rgb(221 122 122 / 78%);
    max-width: 600px;
    margin: 0 auto;
    font-family: 'Segoe UI', sans-serif;
    border: 2px solid #ffffff;
    color: #ffffff;
}

div#deletback {
    background: #ebd1d1;
    padding: 2rem;
    border-radius: 7px;
    box-shadow: 0 2px 10px rgb(0 0 0 / 5%);
    max-width: 600px;
    margin: 0 auto;
    font-family: 'Segoe UI', sans-serif;
    border: 2px solid #cf9696;
}





/* Responsive layout 
@media (max-width: 576px) {

 @media screen and (max-width: 576px) and (min-width: 767px)*/
 
 @media (max-width: 1200px) {
  .d-flex {
    flex-direction: column;
    align-items: stretch;
  }

  .edit-btn {
    align-self: flex-end;
    margin-top: 0.5rem;
  }

  .ms-2 {
    margin-left: 0;
  }
  
  
  button#save-profile-btn {

    width: 41%;}
	
	.btnmainresults, .btnreattemptlist, .btnreattempttest {width: 41%;}
	
	.score-card { background: linear-gradient(136deg, #9988d7, #ffffff,#fbfcfd);}
  
.bubble3 {margin-left: 17em;}
   .bubble-3 {margin-left: 0em;}

}

</style>
  
   
  
</head>
<body>



 
  <nav>
    <label class="logo"><a href="\" class="link">Quiz Pulse </a></label>
<h2 class="userinfo"> </h2>
	<ul id="header-nav"> </ul>
	 
<div class="dropdown">


<a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" >
              <span id="user-name"></span>
			  <img id="user-avatar" src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0ic3ZnLWljb24iIHN0eWxlPSJ3aWR0aDogMWVtOyBoZWlnaHQ6IDFlbTt2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO2ZpbGw6IGN1cnJlbnRDb2xvcjtvdmVyZmxvdzogaGlkZGVuOyIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik01MDcuMzYgMTAzQzI3OS44NCAxMDMgOTQuNzMgMjg4LjEyIDk0LjczIDUxNS42NmE0MjIuNDEgNDIyLjQxIDAgMCAwIDYuNDggNzAuNjFjMCAwLjE0IDAuMjUgMC4wOCAwLjMgMC4yYTEzLjU4IDEzLjU4IDAgMCAwIDEzIDEwLjA2IDEzLjc2IDEzLjc2IDAgMCAwIDEzLjc1LTEzLjc2IDExLjg4IDExLjg4IDAgMCAwLTAuMjctMS4zMmwwLjI0LTAuMTFhMzg2IDM4NiAwIDAgMS02LTY1LjY2YzAtMjEyLjcgMTcyLjQzLTM4NS4xMyAzODUuMTItMzg1LjEzUzg5Mi40OSAzMDMgODkyLjQ5IDUxNS42OCA3MjAuMDYgOTAwLjggNTA3LjM2IDkwMC44Yy0xNDIuMTQgMC0yNjYtNzcuMjItMzMyLjY5LTE5MS43OSAwLTAuMDctMC4wOS0wLjExLTAuMTEtMC4xOC0wLjE4LTAuMy0wLjM4LTAuNTktMC41NS0wLjg5YTEzLjYxIDEzLjYxIDAgMCAwLTEyLTcuMzcgMTMuNzYgMTMuNzYgMCAwIDAtMTMuNzUgMTMuNzUgMTMuNDIgMTMuNDIgMCAwIDAgMi43NCA3LjgzbC0wLjIzIDAuMTRjNzEuNTMgMTIzIDIwNC40MSAyMDYgMzU2LjYxIDIwNkM3MzQuODkgOTI4LjI5IDkyMCA3NDMuMiA5MjAgNTE1LjY2UzczNC44OSAxMDMgNTA3LjM2IDEwM3oiIGZpbGw9IiMzNTg1RjkiIC8+PHBhdGggZD0iTTUwNy4zNyA1NzAuNDNjODIuMzIgMCAxNDkuMzEgNjcgMTQ5LjMxIDE0OS4zMWgyNy41MWMwLTk3LjQ5LTc5LjMyLTE3Ni44Mi0xNzYuODItMTc2Ljgycy0xNzYuODMgNzkuMzMtMTc2LjgzIDE3Ni44MmgyNy41MWMwLTgyLjMzIDY2Ljk1LTE0OS4zMSAxNDkuMzItMTQ5LjMxeiIgZmlsbD0iIzM1ODVGOSIgLz48cGF0aCBkPSJNMzQ0LjI5IDcxOS43NG0tMTMuNzUgMGExMy43NSAxMy43NSAwIDEgMCAyNy41IDAgMTMuNzUgMTMuNzUgMCAxIDAtMjcuNSAwWiIgZmlsbD0iIzM1ODVGOSIgLz48cGF0aCBkPSJNNjcwLjQzIDcxOS43NG0tMTMuNzUgMGExMy43NSAxMy43NSAwIDEgMCAyNy41IDAgMTMuNzUgMTMuNzUgMCAxIDAtMjcuNSAwWiIgZmlsbD0iIzM1ODVGOSIgLz48cGF0aCBkPSJNNTMxLjg1NDQ2NCA0NDguNjIwNjM2bS03Ni45MjYxNDYgNzYuOTI2MTQ3YTEwOC43OSAxMDguNzkgMCAxIDAgMTUzLjg1MjI5My0xNTMuODUyMjk0IDEwOC43OSAxMDguNzkgMCAxIDAtMTUzLjg1MjI5MyAxNTMuODUyMjk0WiIgZmlsbD0iI0JBRDRGRiIgLz48cGF0aCBkPSJNNTA3LjM2IDU3MC40MmMtNzUuMTUgMC0xMzYuMjktNjEuMTQtMTM2LjI5LTEzNi4zczYxLjE0LTEzNi4zIDEzNi4yOS0xMzYuMyAxMzYuMyA2MS4xNSAxMzYuMyAxMzYuMy02MS4xNCAxMzYuMy0xMzYuMyAxMzYuM3ogbTAtMjQ1LjA5YTEwOC44IDEwOC44IDAgMSAwIDEwOC44IDEwOC43OSAxMDguOTIgMTA4LjkyIDAgMCAwLTEwOC44LTEwOC43OXoiIGZpbGw9IiMzNTg1RjkiIC8+PC9zdmc+" class="rounded-circle me-2" alt="User" style="width:30px;height:30px;" class="profile-pic" id="profileToggle">
             
			
			 </a> 
   <ul class="dropdown-menu" id="dropdownMenupp"> 
        <li><i class='bx bxs-dashboard'>  </i> Dashboard</li>
 <li><i class='bx bx-log-out'></i> <a class="dropdown-item" href="#"   id="signout-btn">Logout</a></li>
      </ul>
    </div>
	<!--<div id="notification-container" class="position-fixed top-0 end-0 p-3" style="z-index: 11"></div> -->
  </nav> 







  <div class="container py-5">
    <div class="row mb-4">
      <div class="col-12">
        <h1 class="text-centerp">Test Results</h1>
        <p class=" test-text" id="test-title">Loading Result...</p>
	


		
		
      </div>
    </div>
	

	
	
	
	<div class="row mb-4">
  <div class="col-12 text-center">
    <div class="d-flex justify-content-center gap-3">
      <button id="viewMainResults" class="btnmainresults">
        <i class="fas fa-chart-bar me-2"></i>View Main Results
      </button>
      <button id="reattemptTest" class="btnreattempttest">
        <i class="fas fa-redo me-2"></i>Reattempt Test
      </button> 

<button class="btnreattemptlist" onclick="window.location.href = './reattempt_test_list';" target="_blank">
        <i class="fas fa-redo me-2"></i>list of Reattempt Test
      </button> 

<button id="viewSolution" class="btnmainresults">
        <i class="fas fa-chart-bar me-2"></i>View Solution
      </button>


    </div>
  </div>
</div>

    <!-- Score Summary -->
    <div class="row mb-4">
	
	                
      <div class="col-md-6">
        <div class="score-card text-center">
          <h3>Your Score</h3>
          <h1 id="score-display">0/0</h1>
          <div class="row mt-3">
            <div class="col-3">
			<img src="image/percentage.png" alt="Score" class="score-icon">
              <p class="mb-1">Percentage</p>
              <h4 id="percentage">0%</h4>
            </div>
            <div class="col-3">
			      <img src="https://quiz.a-web.online/image/accuracy.webp" alt="Score" class="score-icon">
              <p class="mb-1">Accuracy</p>
              <h4 id="accuracy">0%</h4>
            </div>
           
			
			
			 <div class="col-3">
			<img src="image/rank.png" alt="Score" class="score-icon">
              <p class="mb-1">Rank</p>
              <h4 id="rank">-</h4>
            </div>
			
			
			  <div class="col-3">
			<img src="image/percentile.png" alt="Score" class="score-icon">
              <p class="mb-1">Percentile</p>
              <h4 id="percentile">-</h4>
            </div>
			
			
			
			
			
          </div>
        </div>
		</div>
	  
    </div>
	
	<div class="row mb-4">
	<center>
	
	   <div class="bubble3">
                                <svg width="61" height="52" viewBox="0 0 61 52" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                    <defs>
                                        <path d="M32 43.992c17.673 0 28.05 17.673 28.05 0S49.674 0 32 0C14.327 0 0 14.327 0 32c0 17.673 14.327 11.992 32 11.992z" id="bubble-1-a"/>
                                    </defs>
                                    <g fill="none" fill-rule="evenodd">
                                        <mask id="bubble-1-b" fill="#fff">
                                            <use xlink:href="#bubble-1-a"/>
                                        </mask>
                                        <use fill="#FF6D8B" xlink:href="#bubble-1-a"/>
                                        <path d="M2 43.992c17.673 0 28.05 17.673 28.05 0S19.674 0 2 0c-17.673 0-32 14.327-32 32 0 17.673 14.327 11.992 32 11.992z" fill="#FF4F73" mask="url(#bubble-1-b)"/>
                                        <path d="M74 30.992c17.673 0 28.05 17.673 28.05 0S91.674-13 74-13C56.327-13 42 1.327 42 19c0 17.673 14.327 11.992 32 11.992z" fill-opacity=".8" fill="#FFA3B5" mask="url(#bubble-1-b)"/>
                                    </g>
                                </svg>
                            </div>
	
	
	
	 <div class="col-sm-2" >
            <div class="score-box">
        <img src="image/correct.png" alt="Score" class="score-icon">
        <div class="score-text">
          <p class="score-title">Correct</p>
          <p class="score-value" id="correct-answers">0/0</p>
		   
        </div>
      </div>
	  </div>
	  
	  
	     <div class="col-sm-2" >
            <div class="score-box">
        <img src="image/incorrect.png" alt="Score" class="score-icon">
        <div class="score-text">
          <p class="score-title">Incorrect</p>
          <p class="score-value" id="incorrect-answers">0/0</p>
        </div>
      </div>
	  </div>
	  
	  
	     <div class="col-sm-2" >
            <div class="score-box">
        <img src="https://quiz.a-web.online/image/attempt.webp" alt="Score" class="score-icon">
        <div class="score-text">
          <p class="score-title">Attempted</p>
          <p class="score-value" id="attempted">0/0</p>
        </div>
      </div>
	  </div>
	  
	  
	     <div class="col-sm-2" >
            <div class="score-box">
        <img src="https://quiz.a-web.online/image/skipped.webp" alt="Score" class="score-icon">
        <div class="score-text">
          <p class="score-title">Skipped</p>
          <p class="score-value" id="skipped">0/0</p>
        </div>
      </div>
	  </div>
	  
	  
	     <div class="col-sm-2" >
            <div class="score-box">
        <img src="image/unseen.png" alt="Score" class="score-icon">
        <div class="score-text">
          <p class="score-title">Unseen</p>
          <p class="score-value" id="unseen">0/0</p>
        </div>
      </div>
	  </div>
	   </center>
</div>
		<div class="row mb-4">
	<center>
	 <div class="col-sm-2" >
            <div class="score-box">
        <img src="https://guidely.in/assets/images/result/test-score.svg" alt="Score" class="score-icon">
        <div class="score-text">
          <p class="score-title">Marked for Review:</p>
          <p class="score-value" id="marked">0/0</p>
		   
        </div>
      </div>
	  </div>
	  
	  <div class="col-sm-2" >
            <div class="score-box">
        <img src="image/totaltime.png" alt="Score" class="score-icon">
        <div class="score-text">
          <p class="score-title">Total Time Spent:</p>
          <p class="score-value" id="total-time">0/0</p>
		   
        </div>
      </div>
	  </div> </center>
	</div>
 <div class="bubble-3p">                           
                                  <svg width="120" height="155" viewBox="0 0 230 235" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                    <defs>
                                        <path d="M196.605 234.11C256.252 234.11 216 167.646 216 108 216 48.353 167.647 0 108 0S0 48.353 0 108s136.959 126.11 196.605 126.11z" id="bubble-4-a"/>
                                    </defs>
                                    <g fill="none" fill-rule="evenodd">
                                        <mask id="bubble-4-b" fill="#fff">
                                            <use xlink:href="#bubble-4-a"/>
                                        </mask>
                                        <use fill="#7CE8DD" xlink:href="#bubble-4-a"/>
                                        <circle fill="#3BDDCC" mask="url(#bubble-4-b)" cx="30" cy="108" r="108"/>
                                        <circle fill="#B1F1EA" opacity=".7" mask="url(#bubble-4-b)" cx="265" cy="88" r="108"/>
                                    </g>
                                </svg>
                         </div>


    <!-- Detailed Metrics -->
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="metric-card">
          <h4 class="mb-3">Score Breakdown</h4>
          <table class="tablep table-borderedp">
            <thead class="table-light">
              <tr>
                <th>Metric</th>
                <th>Count</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Total Questions</td>
                <td id="total-questions">0</td>
              </tr>
              <tr>
                <td>Attempted</td>
                <td id="attempted-count">0</td>
              </tr>
              <tr>
                <td>Not Visited</td>
                <td id="not-visited">0</td>
              </tr>
              <tr>
                <td>Marked for Review</td>
                <td id="marked-review">0</td>
              </tr>
              <tr>
                <td>Answered & Marked for Review</td>
                <td id="answered-marked">0</td>
              </tr>
			  
			  <tr>
                <td>Not Answered</td>
                <td id="not-answered">0</td>
              </tr>
			   <tr>
                <td>Answered</td>
                <td id="myanswered">0</td>
              </tr>
			  
			  
			  
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-md-6">
        <div class="metric-card">
          <h4 class="mb-3">Marks Distribution</h4>
          <table class="tablep table-borderedp">
            <thead class="table-light">
              <tr>
                <th>Status</th>
                <th>Count</th>
                <th>Marks</th>
              </tr>
            </thead>
            <tbody>
              <tr class="correct-answer">
                <td>Correct</td>
                <td id="correct-count">0</td>
                <td id="correct-marks">+0</td>
              </tr>
              <tr class="wrong-answer">
                <td>Incorrect</td>
                <td id="incorrect-count">0</td>
                <td id="incorrect-marks">-0</td>
              </tr>
              <tr class="skipped-answer">
                <td>Skipped</td>
                <td id="skipped-count">0</td>
                <td id="skipped-marks">0</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>


                        <div class="bubble3">
                                <svg width="179" height="126" viewBox="0 0 179 126" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                    <defs>
                                        <path d="M104.697 125.661c41.034 0 74.298-33.264 74.298-74.298s-43.231-7.425-84.265-7.425S0-28.44 0 12.593c0 41.034 63.663 113.068 104.697 113.068z" id="bubble-2-a"/>
                                    </defs>
                                    <g fill="none" fill-rule="evenodd">
                                        <mask id="bubble-2-b" fill="#fff">
                                            <use xlink:href="#bubble-2-a"/>
                                        </mask>
                                        <use fill="#838DEA" xlink:href="#bubble-2-a"/>
                                        <path d="M202.697 211.661c41.034 0 74.298-33.264 74.298-74.298s-43.231-7.425-84.265-7.425S98 57.56 98 98.593c0 41.034 63.663 113.068 104.697 113.068z" fill="#626CD5" mask="url(#bubble-2-b)"/>
                                        <path d="M43.697 56.661c41.034 0 74.298-33.264 74.298-74.298s-43.231-7.425-84.265-7.425S-61-97.44-61-56.407C-61-15.373 2.663 56.661 43.697 56.661z" fill="#B1B6F1" opacity=".64" mask="url(#bubble-2-b)"/>
                                    </g>
                                </svg>

                            </div>
    <!-- Question-wise Analysis -->
    <div class="row">
      <div class="col-12">
        <div class="metric-card">
          <h4 class="mb-3">Question-wise Analysis</h4>
          <div class="table-responsive question-analysis">
            <table class="tablep table-borderedp table-hoverp">
              <thead class="table-light">
                <tr>
                  <th>Q.No.</th>
                  <th>Your Answer</th>
                  <th>Correct Answer</th>
                  <th>Status</th>
                  <th>Time Spent</th>
                </tr>
              </thead>
              <tbody id="question-analysis-body">
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
	
	
	 <div class="bubble-3">
                                <svg width="82" height="288" viewBox="0 0 427 286" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                    <defs>
                                        <path d="M213.5 286C331.413 286 427 190.413 427 72.5S304.221 16.45 186.309 16.45C68.396 16.45 0-45.414 0 72.5S95.587 286 213.5 286z" id="bubble-3-a"/>
                                    </defs>
                                    <g fill="none" fill-rule="evenodd">
                                        <mask id="bubble-3-b" fill="#fff">
                                            <use xlink:href="#bubble-3-a"/>
                                        </mask>
                                        <use fill="#4E8FF8" xlink:href="#bubble-3-a"/>
                                        <path d="M64.5 129.77c117.913 0 213.5-95.588 213.5-213.5 0-117.914-122.779-56.052-240.691-56.052C-80.604-139.782-149-201.644-149-83.73c0 117.913 95.587 213.5 213.5 213.5z" fill="#1274ED" mask="url(#bubble-3-b)"/>
                                        <path d="M381.5 501.77c117.913 0 213.5-95.588 213.5-213.5 0-117.914-122.779-56.052-240.691-56.052C236.396 232.218 168 170.356 168 288.27c0 117.913 95.587 213.5 213.5 213.5z" fill="#75ABF3" mask="url(#bubble-3-b)"/>
                                    </g>
                                </svg>
                            </div>
							
							
  </div>


<section class="contact-area" id="contact">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 offset-lg-3">
                    <div class="contact-content ">
                      
					 <div class="text-center">	<label class="logo "><a href="\" class="link">Quiz Pulse </a></label></div>
						 <div class="row">
						<div class="col-3">
							<ul class="a">
							  <li><a class="hover-target" href="/"></i>Home</a> </li>
							  <li><a class="hover-target" href="/"></i>About Us</a> </li>
							  
							 
							</ul> </div>
							<div class="col-3">
							<ul class="a">
							 <li><a class="hover-target" href="/"></i>Contact Us</a></li>
							  <li><a class="hover-target" href="/"></i>Privacy Policy</a></li>
							</ul></div>
							<div class="col-3">
							<ul class="a">
							 <li><a class="hover-target" href="/"></i>FAQs</a></li>
							  <li><a class="hover-target" href="/"></i>Terms of use</a></li>
							  </ul>
							</div>
							
							<div class="col-3">
							<ul class="a">
							
							  <li><a class="hover-target" href="/"></i>Test Series</a></li>
							  <li><a class="hover-target" href="/"></i>blog</a></li>
							
							  </ul>
							</div>
							
							</div>
                    
						   <hr>

                        <div class="hr"></div>
					
                      <!--  <h6>Take test & analyze your Score with lots of aspirants</h6>-->
                        <h6 class="text-center" >support@quizpulse.online<span>|</span>quizpulse.a-web.online</h6>
                        <div class="contact-social text-center">
                            <ul>
                                <li><a class="hover-target" href=""><i class="fab fa-facebook-f"></i></a></li>
                                <li><a class="hover-target" href=""><i class="fab fa-linkedin-in"></i></a></li>
                                <li><a class="hover-target" href=""><i class="fab fa-telegram"></i></a></li>
                                <li><a class="hover-target" href=""><i class="fab fa-twitter"></i></a></li>
                                <li><a class="hover-target" href=""><i class="fab fa-instagram"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- =============== 1.9 Contact Area End ====================--> 
    <!-- =============== 1.9 Footer Area Start ====================-->
    <footer>
        <h5 class="footerp">Copyright &copy; 2025 - Quiz Pulse | All Rights Reserved.</h5>
    </footer>
 

<script>
// Initialize Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDaaytl89rdhGmBroRPpYEt55zmDjFefQ0",
  authDomain: "quizwiz-91c47.firebaseapp.com",
  projectId: "quizwiz-91c47",
  storageBucket: "quizwiz-91c47.appspot.com",
  messagingSenderId: "318422165023",
  appId: "1:318422165023:web:2966847b71e8777c07172a",
  measurementId: "G-733PML4EFH"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();



console.log("Firebase initialized:", {
  app: firebase.app().name,
  auth: !!auth,
  firestore: !!db
});


document.addEventListener('DOMContentLoaded', async function() {
  // Check authentication first
  const user = await new Promise(resolve => {
    const unsubscribe = auth.onAuthStateChanged(user => {
      unsubscribe();
      resolve(user);
    });
  });

  if (!user) {
    
    window.location.href = "/";
    return;
  } 

  const urlParams = new URLSearchParams(window.location.search);
  const testId = urlParams.get('testId');
  
  
  
  
  // Set up button click handlers
document.getElementById('viewSolution').addEventListener('click', () => {
  window.location.href = `solution?testId=${testId}`;
});

  
  
  
  
  
  
  
  // Add this inside your DOMContentLoaded event listener, after getting the testId
const baseTestId = testId.replace(/_rat\d+$/, ''); // Remove any _rat suffix

// Set up button click handlers
document.getElementById('viewMainResults').addEventListener('click', () => {
  window.location.href = `mock-test/result?testId=${baseTestId}`;
});

document.getElementById('reattemptTest').addEventListener('click', () => {
  // Find the highest existing reattempt number
  let highestAttempt = 0;
  const reattemptKeys = Object.keys(localStorage).filter(key => 
    key.startsWith(`testAttempt_${baseTestId}_rat`) || 
    key.startsWith(`localTest_${baseTestId}_rat`)
  );
  
  reattemptKeys.forEach(key => {
    const match = key.match(/_rat(\d+)_/);
    if (match) {
      const attemptNum = parseInt(match[1]);
      if (attemptNum > highestAttempt) highestAttempt = attemptNum;
    }
  });
  
  const nextAttempt = highestAttempt + 1;


	
	    window.open(`PjDKpZ6HJSVCnUy?testId=${baseTestId}_rat${nextAttempt}&reattempt=true`, '_blank');

  
});
  
  
 
  if (!testId) {
    // Redirect if no testId provided
    window.location.href = "/";
    return;
  }

  // Check if this is a reattempt (contains '_rat')
  const isReattempt = testId.includes('_rat');
  let resultData = null;

  if (isReattempt) {
    // Handle reattempt results from localStorage only
    resultData = getLocalResult(testId, user.email);
    
    if (resultData) {
      const attemptNumber = getAttemptNumber(testId);
      document.querySelector('h1').textContent += ` (Reattempt ${attemptNumber})`;
    }
  } else {
    // Handle main test results
    resultData = await getMainTestResult(testId, user.email);
  }

  if (resultData) {
    displayResults(resultData);
  } else {
    alert("No test results found.");
    window.location.href = "/";
  } 
});

// Helper function to get attempt number from testId
function getAttemptNumber(testId) {
  const match = testId.match(/_rat(\d+)$/);
  return match ? parseInt(match[1]) : 1;
}

// Get result from localStorage
 function getLocalResult(testId, email) {
  const key = `localTest_${testId}_${email}`; // for look like this (localTest_mock3ibps2024cclerk_rat2_1sumitkmr0@gmail.com) in localStorage 
  //const key = `localTest_${testId}_guest`;      // for look like this (localTest_quiz5_rat1_guest) in localStorage 
  const result = JSON.parse(localStorage.getItem(key));
  if (result) {
    console.log("Found in localStorage:", key);
    return result;
  }
  return null;
}



// Function to display error message on the page
function showQuestionLoadError() {
  const errorDiv = document.createElement('div');
 /* errorDiv.className = 'alert alert-danger text-center';
  errorDiv.innerHTML = `
    <strong>Error:</strong> Could not load question data. 
    <a href="javascript:window.location.reload()">Please try refreshing</a>.
  `; */
  
  // Insert at the top of the container
  const container = document.querySelector('.container');
  if (container) {
    container.insertBefore(errorDiv, container.firstChild);
  }
} 



async function getMainTestResult(testId, email) {
  const localStorageKey = `testAttempt_${testId}_${email}`;
  let result = JSON.parse(localStorage.getItem(localStorageKey));
  
  // Define potential domains for JSON fetching
  const testDomains = [
     '',  // Current domain (relative path)
    //'https://quizwiz.a-web.online',
    'https://host-codes.github.io/qweqweq/'
	
    // Add more domains as needed
  ]; 
  

    

  // Helper function to load questions from multiple sources
  async function loadQuestionsWithFallbacks(originalTestId) {
    let lastError = null;
    
    for (const domain of testDomains) {
      try {
        const url = domain ? `${domain}/${originalTestId}.json` : `${originalTestId}.json`;
        //const response = await fetch(url);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const testData = await response.json();
        
        if (!testData?.questions) {
          throw new Error('Test data missing questions');
        }
        
        return testData;
      } catch (error) {
        lastError = error;
        console.warn(`Failed to fetch from ${domain || 'current domain'}:`, error.message);
      }
    }
    
    console.error("All fetch attempts failed:", lastError);
    showQuestionLoadError();
    return null;
  }

  // Check localStorage first
  if (result) {
    // For localStorage results, try to load questions from JSON if missing
    if (!result.currentTest?.questions) {
      const originalTestId = result.originalTestId || testId.replace(/_rat\d+$/, '');
      result.currentTest = await loadQuestionsWithFallbacks(originalTestId);
      // Update localStorage with the loaded questions
      if (result.currentTest) {
        localStorage.setItem(localStorageKey, JSON.stringify(result));
      }
    }
    return result;
  }
  
  // Try Firestore next
  try {
    console.log(`Attempting to fetch from Firestore: testId=${testId}, email=${email}`);
    
    let snapshot;
    try {
      snapshot = await db.collection("mockTests")
        .where("email", "==", email)
        .where("testId", "==", testId)
        .orderBy("timestamp", "desc")
        .limit(1)
        .get();
    } catch (indexError) {
      console.warn("Composite index error, trying without ordering:", indexError);
      snapshot = await db.collection("mockTests")
        .where("email", "==", email)
        .where("testId", "==", testId)
        .limit(1)
        .get();
    }
    
    if (!snapshot.empty) {
      result = snapshot.docs[0].data();
      
      // Load questions from JSON if missing in Firestore data
      if (!result.currentTest?.questions) {
        const originalTestId = result.originalTestId || testId.replace(/_rat\d+$/, '');
        result.currentTest = await loadQuestionsWithFallbacks(originalTestId);
      }
      
      if (result.currentTest) {
        localStorage.setItem(localStorageKey, JSON.stringify(result));
      }
      return result;
    }
  } catch (error) {
    console.error("Firestore error:", error);
    
    // Fallback to JSON from multiple sources
    const originalTestId = testId.replace(/_rat\d+$/, '');
    const testData = await loadQuestionsWithFallbacks(originalTestId);
    
    if (testData) {
      result = {
        email: email,
        testId: testId,
        currentTest: testData,
        answers: [],
        timestamp: new Date().toISOString()
      };
      localStorage.setItem(localStorageKey, JSON.stringify(result));
      return result;
    }
  }
  
  return null;
}




// Helper function to load questions with error handling
async function loadQuestionsWithErrorHandling(testId) {
  try {
    const response = await fetch(`${testId}.json`);
    if (response.ok) {
      return await response.json();
    } else {
      showQuestionLoadError();
    }
  } catch (error) {
    console.error("Couldn't load questions:", error);
    showQuestionLoadError();
  }
  return null;
}










async function displayResults(data) {
  // Calculate metrics if not already present
  if (typeof data.correct === 'undefined') {
    calculateMissingMetrics(data);
  }
  
  // Calculate answered count (attempted minus answered+marked)
  const answeredCount = data.attempted - (data.answeredMarked || 0);
  document.getElementById('myanswered').textContent = answeredCount;
  
  // Score display calculations
  const netScore = data.correct - (data.incorrect * 0.25);
  document.getElementById('score-display').textContent = 
    `${netScore.toFixed(2)}/${data.totalQuestions}`;
  
  // Percentage calculation
  const percentage = (netScore / data.totalQuestions) * 100;
  document.getElementById('percentage').textContent = 
    `${percentage.toFixed(2)}%`;
  
  // Accuracy calculation
  const accuracy = data.attempted > 0 ? (data.correct / data.attempted) * 100 : 0;
  document.getElementById('accuracy').textContent = 
    `${accuracy.toFixed(2)}%`;

  // Performance summary
  document.getElementById('correct-answers').textContent = `${data.correct}/${data.totalQuestions}`;
  document.getElementById('incorrect-answers').textContent = `${data.incorrect}/${data.totalQuestions}`;
  document.getElementById('attempted').textContent = `${data.attempted}/${data.totalQuestions}`;
  document.getElementById('skipped').textContent = `${data.skipped}/${data.totalQuestions}`;
  document.getElementById('unseen').textContent = `${data.notVisited}/${data.totalQuestions}`;
  document.getElementById('marked').textContent = data.marked || 0;
  document.getElementById('answered-marked').textContent = data.answeredMarked || 0;
  document.getElementById('not-answered').textContent = data.notAnswered || 0;
  document.getElementById('total-time').textContent = formatTime(data.totalTime || 0);

  // Score breakdown
  document.getElementById('total-questions').textContent = data.totalQuestions;
  document.getElementById('attempted-count').textContent = data.attempted;
  document.getElementById('not-visited').textContent = data.notVisited;
  document.getElementById('marked-review').textContent = data.marked || 0;
  document.getElementById('answered-marked').textContent = data.answeredMarked || 0;

  // Marks distribution
  document.getElementById('correct-count').textContent = data.correct;
  document.getElementById('incorrect-count').textContent = data.incorrect;
  document.getElementById('skipped-count').textContent = data.skipped;
  document.getElementById('correct-marks').textContent = `+${data.correct}`;
  document.getElementById('incorrect-marks').textContent = `-${(data.incorrect * 0.25).toFixed(2)}`;
  document.getElementById('skipped-marks').textContent = '0';

  // Question-wise analysis
  const tableBody = document.getElementById('question-analysis-body');
  tableBody.innerHTML = '';

  if (!data.answers || !data.answers.length) {
    tableBody.innerHTML = `<tr><td colspan="5">No answer data available</td></tr>`;
    return;
  }

  // Get testId from URL and extract base test name
  const urlParams = new URLSearchParams(window.location.search);
  const testId = urlParams.get('testId');
  const baseTestId = testId.replace(/_rat\d+$/, ''); // Remove _rat2, _rat3 etc.

  try {
    // Define potential domains for JSON fetching
    const testDomains = [
      '', // Current domain (relative path)
      //'https://host-codes.github.io/qweqweq/'
	  'https://qe914u-178fb5.gitlab.io/Jacksontest/'
    ];

    let questionData = null;
    let lastError = null;

    // Try fetching from each domain until successful
    for (const domain of testDomains) {
      try {
        const url = domain ? `${domain}/${baseTestId}.json` : `${baseTestId}.json`;
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        questionData = await response.json();
        
        if (!questionData?.questions) {
          throw new Error('Test data missing questions');
        }
        
        break; // Exit loop if successful
      } catch (error) {
        lastError = error;
        console.warn(`Failed to fetch from ${domain || 'current domain'}:`, error.message);
        continue;
      }
    }

    if (!questionData) {
      throw lastError || new Error('All sources failed to load question data');
    }

    // Set test title from loaded data
    document.getElementById('test-title').textContent = questionData.title || "Test Results";

    // Display attempt number if it's a reattempt
    if (testId.includes('_rat')) {
      const attemptNumber = testId.match(/_rat(\d+)$/)[1];
      // document.querySelector('h1').textContent += ` (Reattempt ${attemptNumber})`;
    }

    // Display question analysis
    data.answers.forEach((userAnswer, index) => {
      const row = document.createElement('tr');
      const question = questionData.questions[index];
      
      // Handle both english and non-english question formats
      const correctAnswer = question.english?.correctAnswer !== undefined ? 
        question.english.correctAnswer : 
        question.correctAnswer;
        
      const isSkipped = userAnswer === null || userAnswer === undefined;
      const timeSpent = data.timeSpentPerQuestion?.[index] || 0;
      const isMarked = data.markedQuestions?.[index];
      const isCorrect = !isSkipped && parseInt(userAnswer) === parseInt(correctAnswer);
      
      // Display user's answer
      const userAnswerDisplay = isSkipped ? 
        '<span class="answer-circle skipped-circle">-</span>' : 
        `<span class="answer-circle ${isCorrect ? 'correct-circle' : 'incorrect-circle'}">
          ${String.fromCharCode(65 + parseInt(userAnswer))}
        </span>`;
      
      // Display correct answer
      const correctAnswerDisplay = String.fromCharCode(65 + parseInt(correctAnswer));
      
      row.innerHTML = `
        <td>${index + 1}</td>
        <td class="text-center">${userAnswerDisplay}</td>
        <td class="text-center">${correctAnswerDisplay}</td>
        <td class="${isCorrect ? 'text-success' : 'text-danger'} fw-bold">
          ${isSkipped ? '0' : (isCorrect ? '+1' : '-0.25')}
        </td>
        <td>${formatTime(timeSpent)}</td>
      `;
      
      tableBody.appendChild(row);
    });

  } catch (error) {
    console.error("Error loading question data:", error);

    // Show error message but still display what data we have
    const errorRow = document.createElement('tr');
    errorRow.innerHTML = `
      <td colspan="5" class="text-center text-danger">
        Partial data loaded - some correct answers may not display
      </td>
    `;
    tableBody.appendChild(errorRow);

    // Try to display whatever answers we can
    data.answers.forEach((userAnswer, index) => {
      const row = document.createElement('tr');
      const isSkipped = userAnswer === null || userAnswer === undefined;
      
      row.innerHTML = `
        <td>${index + 1}</td>
        <td class="text-center">
          ${isSkipped ? 
            '<span class="answer-circle skipped-circle">-</span>' : 
            `<span class="answer-circle answered-circle">
              ${String.fromCharCode(65 + parseInt(userAnswer))}
            </span>`}
        </td>
        <td class="text-center">-</td>
        <td>${isSkipped ? '0' : '?'}</td>
        <td>${formatTime(data.timeSpentPerQuestion?.[index] || 0)}</td>
      `;
      
      tableBody.appendChild(row);
    });
  }
}



function calculateMissingMetrics(data) {
  // Calculate correct/incorrect if not present
  if (typeof data.correct === 'undefined') {
    data.correct = 0;
	
	data.answered = 0;
	
    data.incorrect = 0;
    data.attempted = 0;
    data.skipped = 0;
    data.notVisited = 0;
    data.marked = 0;
    data.answeredAndMarked = 0;
	data.answeredMarked = 0;
    data.notAnswered = 0;

    
    if (data.answers && data.currentTest?.questions) {
      data.answers.forEach((answer, index) => {
        const question = data.currentTest.questions[index];
        if (!question) return;
        
        const correctAnswer = parseInt(question.answer);
        const userAnswer = answer;
        
        if (userAnswer === null || userAnswer === undefined) {
          data.skipped++;
        } else if (parseInt(userAnswer) === correctAnswer) {
          data.correct++;
          data.attempted++;
        } else {
          data.incorrect++;
          data.attempted++;
        }
        
        // Check if marked for review
        if (data.markedQuestions && data.markedQuestions[index]) {
          data.marked++;
          if (userAnswer !== null && userAnswer !== undefined) {
            data.answeredAndMarked++;
          }
        }
      });
    }
    
    // Calculate derived metrics
    data.totalQuestions = data.totalQuestions || (data.currentTest?.questions?.length || 0);
	 //  data.notAnswered = data.totalQuestions - data.attempted;
	   
	  // data.answered = data.attempted - data.answeredMarked;
	   
    data.notVisited = data.totalQuestions - data.attempted - data.skipped;

    data.percentage = (data.correct / data.totalQuestions) * 100;
    data.accuracy = data.attempted > 0 ? (data.correct / data.attempted) * 100 : 0;
    data.score = data.correct - (data.incorrect * 0.25);
  }
}




function formatTime(seconds) {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}



</script>



  <script type="module">
  //  Firebase config
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDaaytl89rdhGmBroRPpYEt55zmDjFefQ0",
    authDomain: "quizwiz-91c47.firebaseapp.com",
    projectId: "quizwiz-91c47",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  //  Helper to get testId from URL
  function getTestIdFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get("testId");
  }

  //  Google Apps Script endpoint URL
  const scriptURL = "https://script.google.com/macros/s/AKfycbxnQlGYratuVB2-1WwcbV5p5v94cJxQ9b0McF9c7yK0738GtLhXyk19JM-imQSQ8c6Nkw/exec";

  //  Wait for user auth and fetch result
  onAuthStateChanged(auth, (user) => {
    if (user) {
      const testId = getTestIdFromURL();
      const email = user.email;

      //  Call Apps Script with email & testId
      fetch(`${scriptURL}?email=${encodeURIComponent(email)}&testId=${encodeURIComponent(testId)}`)
        .then((res) => res.json())
        .then((data) => {
          console.log("Response from Apps Script:", data);

          if (data.error) {
            document.getElementById("rank").textContent = "Not Found";
            document.getElementById("percentile").textContent = "-";
            return;
          }

          const rank = data["Rank"] || "-";
          const total = data["Total Participants"] || "-";
          const percentile = data["Percentile"] || "-";

          document.getElementById("rank").textContent = ` ${rank}/${total}`;
          document.getElementById("percentile").textContent = ` ${percentile}%`;
        })
		
	
        .catch((err) => {
          console.error("Fetch error:", err);
          document.getElementById("rank").textContent = "-";
          document.getElementById("percentile").textContent = "-";
        });
    } else {
      document.getElementById("rank").textContent = "Login Required";
      document.getElementById("percentile").textContent = "-";
    }
  });
</script>

<script type="module" src="https://qe914u-178fb5.gitlab.io/js/resultmocktest.jsp"></script>
<script type="module" src="https://qe914u-178fb5.gitlab.io/js/updatefromgoogle.jsp"></script>
<script type="module" src="https://qe914u-178fb5.gitlab.io/js/fornormalpageloginsignout.js"></script>
</body>
</html>
